C51 COMPILER V9.54   LIS3DH                                                                02/10/2025 19:42:17 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE LIS3DH
OBJECT MODULE PLACED IN .\Objects\LIS3DH.obj
COMPILER INVOKED BY: D:\Keil_5\C51\BIN\C51.EXE LIS3DH.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\LIS
                    -3DH.lst) TABS(2) OBJECT(.\Objects\LIS3DH.obj)

line level    source

   1          #include <STC8H.H>
   2          #include "LIS3DH.h"
   3          #include "spi.h"
   4          
   5          lis3dh lis;
   6          char direction;
   7          
   8          void lis3dh_init()
   9          {
  10   1          spi_exchangebyte(0x20);//CTRL_REG0
  11   1          spi_exchangebyte(0x47);//50Hz
  12   1      }
  13          
  14          void get_xyz()
  15          {
  16   1          //正常模式 十位输出
  17   1          spi_exchangebyte(XH | 0x80); // x轴高位地址，读操作，地址不递增
  18   1          lis.x_axis = ((signed int)spi_exchangebyte(0x00) << 8);
  19   1          spi_exchangebyte(XL | 0x80); // x轴低位地址，读操作，地址不递增
  20   1          lis.x_axis |= spi_exchangebyte(0x00);
  21   1      
  22   1          spi_exchangebyte(YH | 0x80); // y轴高位地址，读操作，地址不递增
  23   1          lis.y_axis = ((signed int)spi_exchangebyte(0x00) << 8);
  24   1          spi_exchangebyte(YL | 0x80); // y轴低位地址，读操作，地址不递增
  25   1          lis.y_axis |= spi_exchangebyte(0x00);
  26   1      
  27   1          spi_exchangebyte(ZH | 0x80); // z轴高位地址，读操作，地址不递增
  28   1          lis.z_axis = ((signed int)spi_exchangebyte(0x00) << 8);
  29   1          spi_exchangebyte(ZL | 0x80); // z轴低位地址，读操作，地址不递增
  30   1          lis.z_axis |= spi_exchangebyte(0x00);
  31   1      
  32   1          // 补码转换正负号   
  33   1          //-1 0000 0000 0000 0001 / 1111 1111 1111 1111 /0000 0000 0000 0001/1000 0000 0000 0001
  34   1          //-512 0000 0010 0000 0000/ 1111 1101 1111 1111 / 0000 0010 0000 0001 /
  35   1          if (lis.x_axis & 0x8000)
  36   1              lis.x_axis = (~lis.x_axis + 1) | 0x8000;
  37   1          if (lis.y_axis & 0x8000)
  38   1              lis.y_axis = (~lis.y_axis + 1) | 0x8000;
  39   1          if (lis.z_axis & 0x8000)
  40   1              lis.z_axis = (~lis.z_axis + 1) | 0x8000;
  41   1      }
  42          
  43          void get_direction()/////////存疑
  44          {
  45   1          get_xyz();
  46   1          if (lis.x_axis < -128)
  47   1              direction = Down;
  48   1          if (lis.x_axis > 128)
  49   1              direction = Up;
  50   1          if (lis.y_axis < -128)
  51   1              direction = Left;
  52   1          if (lis.y_axis > 128)
  53   1              direction = Right;
  54   1      }
C51 COMPILER V9.54   LIS3DH                                                                02/10/2025 19:42:17 PAGE 2   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    243    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
